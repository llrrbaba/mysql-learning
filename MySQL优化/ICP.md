#### ICP

[MySQL ICP 链接](https://dev.mysql.com/doc/refman/5.6/en/index-condition-pushdown-optimization.html)

索引条件下推(ICP)是MySQL使用索引从表中检索行的一种优化。如果没有ICP，存储引擎将遍历索引来定位基表中的行，并将它们返回给MySQL服务器，MySQL服务器将计算这些行的WHERE条件。启用了ICP，如果只使用来自索引的列就可以评估WHERE条件的一部分，那么MySQL服务器将这部分WHERE条件下推到存储引擎。然后，存储引擎通过使用索引条目来评估推入的索引条件，并且只有从表中读取的行满足此条件时才会这样做。ICP可以减少存储引擎必须访问基表的次数和MySQL服务器必须访问存储引擎的次数。

下推优化指标条件的适用性受制于以下条件:

- 当需要访问完整的表行时，ICP用`range`·、`ref`、`eq_ref`和`ref_or_null`访问方法。
- ICP可用于InnoDB和MyISAM表。(例外:MySQL 5.6中分区表不支持ICP;这个问题在MySQL 5.7中解决了。)
- 对于InnoDB表，**ICP仅用于二级索引**。ICP的目标是减少全行读的数量，从而减少I/O操作。对于InnoDB聚集索引，完整的记录已经被读入InnoDB缓冲区。在这种情况下使用ICP不会减少I/O。
- 引用子查询的条件不能下推。
- 引用存储函数的onditions不能下推。存储引擎不能调用存储的函数。
- 触发条件不能向下推。(有关触发条件的信息，请参阅8.2.2.3节，“使用EXISTS策略优化子查询”。)

要理解这种优化如何工作，首先考虑索引条件下推不使用时，索引扫描如何进行:

​	1.获取下一行，首先读取索引元组，然后使用索引元组定位并读取整个表行。

​	2.测试应用于此表的WHERE条件的部分。根据测试结果接受或拒绝该行。

使用索引条件下推，扫描过程如下:

​	1.获取下一行的索引元组(但不是整个表行)。

​	2.测试应用于此表的WHERE条件的一部分，并且只能使用索引列进行检查。如果条件不满足，则转到下一行的索引元组。

​	3.如果条件满足，则使用索引元组来定位和读取整个表行。

​	4.测试应用于此表的WHERE条件的其余部分。根据测试结果接受或拒绝该行。

`EXPLAIN`输出显示了当使用索引条件下推时，在`extra`的列中使用索引条件。它没有显示使用索引，因为在必须读取完整的表行时，这并不适用。
